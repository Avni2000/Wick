<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Wick Trading â€” Sidebar Reference</title>

    <!--
    CODICONS
    ------------------------------------------
    For a quick demo/reference, this uses the public codicons CDN.
    In a real VS Code webview, bundle codicon.css/font and load it via:
      const uri = webview.asWebviewUri(vscode.Uri.joinPath(extUri, 'media', 'codicon.css'));
      <link rel="stylesheet" href="${uri}">
  -->
    <link rel="stylesheet" href="https://microsoft.github.io/vscode-codicons/dist/codicon.css" />

    <style>
        /* Base reset */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --row-h: 22px;
            --pad-x: 8px;
            --shadow-size: 12px;
            /* scroll shadow size */
        }

        html,
        body {
            height: 100%;
        }

        body {
            color: var(--vscode-foreground, #cccccc);
            font-family: var(--vscode-font-family, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif);
            background: var(--vscode-sideBar-background, #1e1e1e);
            font-size: 13px;
            line-height: var(--row-h);
        }

        /* Sidebar container */
        .sidebar {
            background: var(--vscode-sideBar-background, #1e1e1e);
            height: 100vh;
            overflow: auto;
            border-right: 1px solid var(--vscode-sideBar-border, rgba(255, 255, 255, 0.06));

            /* Scroll shadows (pure CSS, no JS) */
            /* Fades top/bottom edges to hint scrollability */
            -webkit-mask-image: linear-gradient(to bottom,
                    transparent,
                    black var(--shadow-size),
                    black calc(100% - var(--shadow-size)),
                    transparent);
            mask-image: linear-gradient(to bottom,
                    transparent,
                    black var(--shadow-size),
                    black calc(100% - var(--shadow-size)),
                    transparent);
        }

        /* View tabs (like VS Code view switchers) */
        .tab-item {
            display: block;
            width: 100%;
            text-align: left;
            height: var(--row-h);
            line-height: var(--row-h);
            padding: 0 calc(var(--pad-x) + 6px) 0 calc(var(--pad-x) + 10px);
            border: 0;
            background: transparent;
            color: var(--vscode-descriptionForeground, #9d9d9d);
            cursor: pointer;
            border-left: 2px solid transparent;
            user-select: none;
            font-size: 13px;
        }

        .tab-item:hover {
            background: var(--vscode-list-hoverBackground, #2a2d2e);
            color: var(--vscode-foreground, #cccccc);
        }

        .tab-item.active {
            border-left-color: var(--vscode-descriptionForeground, #6e6e6e);
            background: var(--vscode-list-activeSelectionBackground, rgba(255, 255, 255, 0.08));
            color: var(--vscode-list-activeSelectionForeground, #ffffff);
        }

        /* Section separators */
        .files {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid var(--vscode-sideBarSectionHeader-border, rgba(255, 255, 255, 0.06));
        }

        /* Folder blocks */
        .folder {
            margin: 2px 0;
        }

        .folder-header {
            display: flex;
            align-items: center;
            height: var(--row-h);
            padding: 0 var(--pad-x);
            color: var(--vscode-foreground, #cccccc);
            user-select: none;
            cursor: pointer;
            /* purely visual for this reference */
        }

        .folder-header:hover {
            background: var(--vscode-list-hoverBackground, #2a2d2e);
        }

        .chevron {
            width: 16px;
            height: 16px;
            margin-right: 4px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: var(--vscode-icon-foreground, currentColor);
            transition: transform 0.12s ease;
        }

        /* In a live version, toggle this class to rotate the chevron */
        .folder.collapsed .chevron {
            transform: rotate(-90deg);
        }

        .folder-name {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.4px;
            color: var(--vscode-sideBarSectionHeader-foreground, var(--vscode-foreground, #cccccc));
            flex: 1;
        }

        .folder-content {
            display: block;
        }

        .folder.collapsed .folder-content {
            display: none;
        }

        /* File rows */
        .file-item {
            display: flex;
            align-items: center;
            height: var(--row-h);
            padding: 0 calc(var(--pad-x)) 0 calc(26px);
            color: var(--vscode-descriptionForeground, #9d9d9d);
            cursor: pointer;
            /* purely visual for this reference */
            font-size: 13px;
        }

        .file-item:hover {
            background: var(--vscode-list-hoverBackground, #2a2d2e);
            color: var(--vscode-foreground, #cccccc);
        }

        /* Add .selected in your app to style current row */
        .file-item.selected {
            background: var(--vscode-list-inactiveSelectionBackground, rgba(255, 255, 255, 0.06));
            color: var(--vscode-list-inactiveSelectionForeground, var(--vscode-foreground, #cccccc));
        }

        /* Add (+) button */
        .add-button {
            margin-left: auto;
            padding: 0 6px;
            background: transparent;
            color: var(--vscode-icon-foreground, currentColor);
            border: none;
            cursor: pointer;
            font-size: 14px;
            height: 18px;
            line-height: 16px;
            border-radius: 3px;
            opacity: 0;
            /* reveal on hover */
            transition: opacity 0.1s, background 0.1s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .folder-header:hover .add-button {
            opacity: 1;
        }

        .add-button:hover {
            background: var(--vscode-list-hoverBackground, #2a2d2e);
        }

        /* Focus states (keyboard users) */
        .tab-item:focus-visible,
        .folder-header:focus-visible,
        .file-item:focus-visible,
        .add-button:focus-visible {
            outline: 1px solid var(--vscode-descriptionForeground, #6e6e6e);
            outline-offset: -1px;
        }

        /* High contrast friendly */
        @media (forced-colors: active) {
            .tab-item.active {
                border-left-color: Highlight;
            }
        }

        /* Reduce motion */
        @media (prefers-reduced-motion: reduce) {
            .chevron {
                transition: none;
            }
        }
    </style>
</head>

<body>
    <aside class="sidebar" role="navigation" aria-label="Wick Trading Sidebar">
        <!-- Tabs -->
        <button class="tab-item active" role="tab" aria-selected="true" data-tab="chart">Chart</button>
        <button class="tab-item" role="tab" aria-selected="false" data-tab="strategy-builder">Strategy Builder</button>
        <button class="tab-item" role="tab" aria-selected="false" data-tab="backtesting">Backtesting</button>

        <!-- Files/Sections -->
        <div class="files" role="tree">
            <!-- Sample strategies -->
            <div class="folder" id="sample-strategies" role="treeitem" aria-expanded="true">
                <div class="folder-header" tabindex="0" aria-controls="sample-strategies-content"
                    onclick="toggleFolder('sample-strategies', event)">
                    <!-- Codicon chevron with text fallback via aria-label -->
                    <span class="chevron" aria-hidden="true">
                        <span class="codicon codicon-chevron-down"></span>
                    </span>
                    <span class="folder-name">sample strategies</span>
                </div>
                <div class="folder-content" id="sample-strategies-content" role="group">
                    <div class="file-item" role="treeitem" tabindex="0">moving_average.py</div>
                    <div class="file-item" role="treeitem" tabindex="0">rsi_strategy.py</div>
                    <div class="file-item" role="treeitem" tabindex="0">bollinger_bands.py</div>
                    <div class="file-item" role="treeitem" tabindex="0">macd_crossover.py</div>
                </div>
            </div>

            <!-- User strategies -->
            <div class="folder" id="strategies" role="treeitem" aria-expanded="true">
                <div class="folder-header" tabindex="0" aria-controls="strategies-content"
                    onclick="toggleFolder('strategies', event)">
                    <span class="chevron" aria-hidden="true">
                        <span class="codicon codicon-chevron-down"></span>
                    </span>
                    <span class="folder-name">Strategies</span>
                    <!-- Add button using Codicons -->
                    <button class="add-button" title="Add file" aria-label="Add file" onclick="addFile(event)">
                        <span class="codicon codicon-add"></span>
                    </button>
                </div>
                <div class="folder-content" id="strategies-content" role="group">
                    <!-- Dynamically added items would go here in your app -->
                    <div class="file-item" role="treeitem" tabindex="0">my_strategy.py</div>
                </div>
            </div>
        </div>
    </aside>

    <script>
        const vscode = acquireVsCodeApi();

        // Tab switching
        document.querySelectorAll('.tab-item').forEach(tab => {
            tab.addEventListener('click', () => setActiveTab(tab));
            tab.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); setActiveTab(tab); }
            });
        });

        function setActiveTab(tab) {
            document.querySelectorAll('.tab-item').forEach(t => {
                t.classList.toggle('active', t === tab);
                t.setAttribute('aria-selected', t === tab ? 'true' : 'false');
            });
            const tabName = tab.getAttribute('data-tab');
            document.querySelectorAll('.tab-content-area').forEach(c => c.classList.remove('active'));
            const contentArea = document.getElementById(`${tabName}-content`);
            if (contentArea) contentArea.classList.add('active');

            if (tabName === 'chart') {
                vscode.postMessage({ command: 'showChart' });
            } else if (tabName === 'strategy-builder') {
                vscode.postMessage({ command: 'showStrategyBuilder' });
            }
        }

        // Initialize: trigger chart if it's the default active tab
        function initializeSidebar() {
            const activeTab = document.querySelector('.tab-item.active');
            if (activeTab && activeTab.getAttribute('data-tab') === 'chart') {
                vscode.postMessage({ command: 'showChart' });
            }
            // Request the file list from the extension
            vscode.postMessage({ command: 'requestFileList' });
        }

        // Run initialization when the page loads
        initializeSidebar();

        // Folder toggle + keyboard
        function toggleFolder(folderId, event) {
            if (event) event.stopPropagation();
            const folder = document.getElementById(folderId);
            const isCollapsed = folder.classList.toggle('collapsed');
            folder.setAttribute('aria-expanded', isCollapsed ? 'false' : 'true');
        }

        document.querySelectorAll('.folder-header').forEach(h => {
            h.addEventListener('keydown', (e) => {
                const folder = h.parentElement;
                if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); folder.click(); }
                if (e.key === 'ArrowLeft') { folder.classList.add('collapsed'); folder.setAttribute('aria-expanded', 'false'); }
                if (e.key === 'ArrowRight') { folder.classList.remove('collapsed'); folder.setAttribute('aria-expanded', 'true'); }
            });
        });

        // File selection styling
        document.addEventListener('click', (e) => {
            const row = e.target.closest('.file-item');
            if (!row) return;
            e.stopPropagation();
            document.querySelectorAll('.file-item.selected').forEach(n => n.classList.remove('selected'));
            row.classList.add('selected');
        });

        // Add file - send message to extension to show native input box
        function addFile(event) {
            event.stopPropagation();
            vscode.postMessage({ command: 'requestAddStrategy' });
        }

        // Listen for messages from the extension
        window.addEventListener('message', event => {
            const message = event.data;
            switch (message.type) {
                case 'fileList':
                    updateFileList(message.files);
                    break;
            }
        });

        // Update the file list in the Strategies folder
        function updateFileList(files) {
            const content = document.getElementById('strategies-content');
            if (!content) return;

            // Clear existing files
            content.innerHTML = '';

            // Add each file
            if (files && files.length > 0) {
                files.forEach(fileName => {
                    const fileItem = document.createElement('div');
                    fileItem.className = 'file-item';
                    fileItem.setAttribute('role', 'treeitem');
                    fileItem.setAttribute('tabindex', '0');
                    fileItem.textContent = fileName;
                    content.appendChild(fileItem);
                });
            } else {
                // Show a placeholder if no files exist
                const placeholder = document.createElement('div');
                placeholder.className = 'file-item';
                placeholder.style.fontStyle = 'italic';
                placeholder.style.opacity = '0.6';
                placeholder.textContent = 'No strategy files';
                content.appendChild(placeholder);
            }
        }
    </script>
</body>

</html>