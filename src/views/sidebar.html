<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Wick Trading â€” Sidebar Reference</title>

    <!--
    CODICONS
    ------------------------------------------
    For a quick demo/reference, this uses the public codicons CDN.
    In a real VS Code webview, bundle codicon.css/font and load it via:
      const uri = webview.asWebviewUri(vscode.Uri.joinPath(extUri, 'media', 'codicon.css'));
      <link rel="stylesheet" href="${uri}">
  -->
    <link rel="stylesheet" href="https://microsoft.github.io/vscode-codicons/dist/codicon.css" />

    <style>
        /* Base reset */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --row-h: 22px;
            --pad-x: 8px;
            --shadow-size: 12px;
            /* scroll shadow size */
        }

        html,
        body {
            height: 100%;
        }

        body {
            color: var(--vscode-foreground, #cccccc);
            font-family: var(--vscode-font-family, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif);
            background: var(--vscode-sideBar-background, #1e1e1e);
            font-size: 13px;
            line-height: var(--row-h);
        }

        /* Sidebar container */
        .sidebar {
            background: var(--vscode-sideBar-background, #1e1e1e);
            height: 100vh;
            overflow-y: auto;
            overflow-x: hidden;
            border-right: 1px solid var(--vscode-sideBar-border, rgba(255, 255, 255, 0.06));
        }

        /* View tabs (like VS Code view switchers) */
        .tab-item {
            display: block;
            width: 100%;
            text-align: left;
            height: var(--row-h);
            line-height: var(--row-h);
            padding: 0 calc(var(--pad-x) + 6px) 0 calc(var(--pad-x) + 10px);
            border: 0;
            background: transparent;
            color: var(--vscode-descriptionForeground, #9d9d9d);
            cursor: pointer;
            border-left: 2px solid transparent;
            user-select: none;
            font-size: 13px;
        }

        .tab-item:hover {
            background: var(--vscode-list-hoverBackground, #2a2d2e);
            color: var(--vscode-foreground, #cccccc);
        }

        .tab-item.active {
            border-left-color: var(--vscode-descriptionForeground, #6e6e6e);
            background: var(--vscode-list-activeSelectionBackground, rgba(255, 255, 255, 0.08));
            color: var(--vscode-list-activeSelectionForeground, #ffffff);
        }

        /* Section separators */
        .files {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid var(--vscode-sideBarSectionHeader-border, rgba(255, 255, 255, 0.06));
        }

        /* Folder blocks */
        .folder {
            margin: 2px 0;
        }

        .folder-header {
            display: flex;
            align-items: center;
            height: var(--row-h);
            padding: 0 var(--pad-x);
            color: var(--vscode-foreground, #cccccc);
            user-select: none;
            cursor: pointer;
            /* purely visual for this reference */
        }

        .folder-header:hover {
            background: var(--vscode-list-hoverBackground, #2a2d2e);
        }

        .chevron {
            width: 16px;
            height: 16px;
            margin-right: 4px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: var(--vscode-icon-foreground, currentColor);
            transition: transform 0.12s ease;
        }

        /* In a live version, toggle this class to rotate the chevron */
        .folder.collapsed .chevron {
            transform: rotate(-90deg);
        }

        .folder-name {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.4px;
            color: var(--vscode-sideBarSectionHeader-foreground, var(--vscode-foreground, #cccccc));
            flex: 1;
        }

        .folder-content {
            display: block;
        }

        .folder.collapsed .folder-content {
            display: none;
        }

        /* File rows */
        .file-item {
            display: flex;
            align-items: center;
            height: var(--row-h);
            padding: 0 calc(var(--pad-x)) 0 calc(26px);
            color: var(--vscode-descriptionForeground, #9d9d9d);
            cursor: pointer;
            /* purely visual for this reference */
            font-size: 13px;
        }

        .file-item:hover {
            background: var(--vscode-list-hoverBackground, #2a2d2e);
            color: var(--vscode-foreground, #cccccc);
        }

        /* Add .selected in your app to style current row */
        .file-item.selected {
            background: var(--vscode-list-inactiveSelectionBackground, rgba(255, 255, 255, 0.06));
            color: var(--vscode-list-inactiveSelectionForeground, var(--vscode-foreground, #cccccc));
        }

        /* Add (+) button */
        .add-button {
            margin-left: auto;
            padding: 0 6px;
            background: transparent;
            color: var(--vscode-icon-foreground, currentColor);
            border: none;
            cursor: pointer;
            font-size: 14px;
            height: 18px;
            line-height: 16px;
            border-radius: 3px;
            opacity: 0;
            /* reveal on hover */
            transition: opacity 0.1s, background 0.1s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .folder-header:hover .add-button {
            opacity: 1;
        }

        .add-button:hover {
            background: var(--vscode-list-hoverBackground, #2a2d2e);
        }

        /* Focus states (keyboard users) */
        .tab-item:focus-visible,
        .folder-header:focus-visible,
        .file-item:focus-visible,
        .add-button:focus-visible {
            outline: 1px solid var(--vscode-descriptionForeground, #6e6e6e);
            outline-offset: -1px;
        }

        /* High contrast friendly */
        @media (forced-colors: active) {
            .tab-item.active {
                border-left-color: Highlight;
            }
        }

        /* Reduce motion */
        @media (prefers-reduced-motion: reduce) {
            .chevron {
                transition: none;
            }
        }

        /* Tab Content Areas */
        .tab-content-area {
            display: none;
        }

        .tab-content-area.active {
            display: block;
        }
    </style>
</head>

<body>
    <aside class="sidebar" role="navigation" aria-label="Wick Trading Sidebar">
        <!-- Header with Settings -->
        <div
            style="display: flex; align-items: center; justify-content: space-between; padding: 10px var(--pad-x); border-bottom: 1px solid var(--vscode-sideBarSectionHeader-border, rgba(255, 255, 255, 0.06)); margin-bottom: 10px;">
            <span style="font-weight: 600; font-size: 11px; text-transform: uppercase;">Wick Trading</span>
            <button class="add-button" title="Open Settings" onclick="openSettings()" style="opacity: 1;">
                <span class="codicon codicon-settings-gear"></span>
            </button>
        </div>

        <!-- Tabs -->
        <button class="tab-item active" role="tab" aria-selected="true" data-tab="chart">Chart</button>
        <button class="tab-item" role="tab" aria-selected="false" data-tab="strategy-builder">Strategy Builder</button>
        <button class="tab-item" role="tab" aria-selected="false" data-tab="custom-backtest">Custom Backtest</button>

        <!-- Files/Sections -->
        <div class="files" role="tree">
            <!-- Chart Content (Initially Active) -->
            <div id="chart-content" class="tab-content-area active">
                <!-- Chart specific sidebar content can go here if needed -->
            </div>

            <!-- Custom Backtest Content -->
            <div id="custom-backtest-content" class="tab-content-area">
                <!-- Backtest Config -->
                <div class="folder" id="config" role="treeitem" aria-expanded="true">
                    <div class="folder-header" tabindex="0" aria-controls="config-content"
                        onclick="toggleFolder('config', event)">
                        <span class="chevron" aria-hidden="true">
                            <span class="codicon codicon-chevron-down"></span>
                        </span>
                        <span class="folder-name">Backtest</span>
                    </div>
                    <div class="folder-content" id="config-content" role="group">
                        <!-- custom_backtest.py will go here -->
                    </div>
                </div>
            </div>

            <!-- Strategy Builder Content -->
            <div id="strategy-builder-content" class="tab-content-area">
                <!-- User strategies -->
                <div class="folder" id="strategies" role="treeitem" aria-expanded="true">
                    <div class="folder-header" tabindex="0" aria-controls="strategies-content"
                        onclick="toggleFolder('strategies', event)">
                        <span class="chevron" aria-hidden="true">
                            <span class="codicon codicon-chevron-down"></span>
                        </span>
                        <span class="folder-name">Strategies</span>
                        <!-- Add button using Codicons -->
                        <button class="add-button" title="Add file" aria-label="Add file" onclick="addFile(event)">
                            <span class="codicon codicon-add"></span>
                        </button>
                    </div>
                    <div class="folder-content" id="strategies-content" role="group">
                        <!-- Dynamically added items would go here in your app -->
                        <div class="file-item" role="treeitem" tabindex="0">my_strategy.py</div>
                    </div>
                </div>
            </div>
        </div>
    </aside>

    <script>
        const vscode = acquireVsCodeApi();

        // Tab switching
        document.querySelectorAll('.tab-item').forEach(tab => {
            tab.addEventListener('click', () => setActiveTab(tab));
            tab.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); setActiveTab(tab); }
            });
        });

        function setActiveTab(tab) {
            document.querySelectorAll('.tab-item').forEach(t => {
                t.classList.toggle('active', t === tab);
                t.setAttribute('aria-selected', t === tab ? 'true' : 'false');
            });
            const tabName = tab.getAttribute('data-tab');
            document.querySelectorAll('.tab-content-area').forEach(c => c.classList.remove('active'));
            const contentArea = document.getElementById(`${tabName}-content`);
            if (contentArea) contentArea.classList.add('active');

            if (tabName === 'chart') {
                vscode.postMessage({ command: 'showChart' });
            } else if (tabName === 'strategy-builder') {
                vscode.postMessage({ command: 'showStrategyBuilder' });
            } else if (tabName === 'custom-backtest') {
                vscode.postMessage({ command: 'openCustomBacktest' });
            }
        }

        // Initialize: trigger chart if it's the default active tab
        function initializeSidebar() {
            const activeTab = document.querySelector('.tab-item.active');
            if (activeTab && activeTab.getAttribute('data-tab') === 'chart') {
                vscode.postMessage({ command: 'showChart' });
            }
            // Request the file list from the extension
            vscode.postMessage({ command: 'requestFileList' });
        }

        // Run initialization when the page loads
        initializeSidebar();

        // Folder toggle + keyboard
        function toggleFolder(folderId, event) {
            if (event) event.stopPropagation();
            const folder = document.getElementById(folderId);
            const isCollapsed = folder.classList.toggle('collapsed');
            folder.setAttribute('aria-expanded', isCollapsed ? 'false' : 'true');
        }

        document.querySelectorAll('.folder-header').forEach(h => {
            h.addEventListener('keydown', (e) => {
                const folder = h.parentElement;
                if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); folder.click(); }
                if (e.key === 'ArrowLeft') { folder.classList.add('collapsed'); folder.setAttribute('aria-expanded', 'false'); }
                if (e.key === 'ArrowRight') { folder.classList.remove('collapsed'); folder.setAttribute('aria-expanded', 'true'); }
            });
        });

        // File selection styling and opening
        document.addEventListener('click', (e) => {
            const row = e.target.closest('.file-item');
            if (!row) return;
            // If clicking the run button, don't select the row
            if (e.target.closest('.run-btn')) return;

            e.stopPropagation();
            document.querySelectorAll('.file-item.selected').forEach(n => n.classList.remove('selected'));
            row.classList.add('selected');

            // Open file in VS Code editor if it's a .py file
            const fileName = row.querySelector('.file-name').textContent.trim();
            if (fileName.endsWith('.py') && fileName !== 'No strategy files') {
                vscode.postMessage({ command: 'openFile', fileName: fileName });
            }
        });

        // Add file - send message to extension to show native input box
        function addFile(event) {
            event.stopPropagation();
            vscode.postMessage({ command: 'requestAddStrategy' });
        }

        // Run custom backtest
        function runCustomBacktest(event, fileName) {
            event.stopPropagation();
            vscode.postMessage({ command: 'runCustomBacktest', fileName: fileName });
        }

        // Open Settings
        function openSettings() {
            vscode.postMessage({ command: 'openSettings' });
        }

        // Listen for messages from the extension
        window.addEventListener('message', event => {
            const message = event.data;
            switch (message.type) {
                case 'fileList':
                    updateFileList(message.files);
                    break;
                case 'setActiveTab':
                    const tab = document.querySelector(`.tab-item[data-tab="${message.tab}"]`);
                    if (tab) {
                        setActiveTab(tab);
                    }
                    break;
            }
        });

        // Update the file list in the Strategies folder
        function updateFileList(files) {
            const strategiesContent = document.getElementById('strategies-content');
            const configContent = document.getElementById('config-content');

            if (!strategiesContent || !configContent) return;

            // Clear existing files
            strategiesContent.innerHTML = '';
            configContent.innerHTML = '';

            if (!files || files.length === 0) {
                showPlaceholder(strategiesContent, 'No strategy files');
                showPlaceholder(configContent, 'No config files');
                return;
            }

            // Separate files
            const configFiles = files.filter(f => f === 'custom_backtest.py');
            const strategyFiles = files.filter(f => f !== 'custom_backtest.py');

            // Render Config Files
            if (configFiles.length > 0) {
                configFiles.forEach(fileName => {
                    const fileItem = createFileItem(fileName, false); // No run button for config
                    configContent.appendChild(fileItem);
                });
            } else {
                showPlaceholder(configContent, 'No config files');
            }

            // Render Strategy Files
            if (strategyFiles.length > 0) {
                strategyFiles.forEach(fileName => {
                    const fileItem = createFileItem(fileName, true); // Add run button
                    strategiesContent.appendChild(fileItem);
                });
            } else {
                showPlaceholder(strategiesContent, 'No strategy files');
            }
        }

        function createFileItem(fileName, hasRunButton) {
            const fileItem = document.createElement('div');
            fileItem.className = 'file-item';
            fileItem.setAttribute('role', 'treeitem');
            fileItem.setAttribute('tabindex', '0');

            // File name span
            const nameSpan = document.createElement('span');
            nameSpan.className = 'file-name';
            nameSpan.textContent = fileName;
            nameSpan.style.flex = '1';
            nameSpan.style.overflow = 'hidden';
            nameSpan.style.textOverflow = 'ellipsis';
            nameSpan.style.whiteSpace = 'nowrap';

            fileItem.appendChild(nameSpan);

            // Run button (only for strategies)
            if (hasRunButton) {
                const runBtn = document.createElement('button');
                runBtn.className = 'add-button run-btn';
                runBtn.title = 'Run Custom Backtest';
                runBtn.innerHTML = '<span class="codicon codicon-play"></span>';
                runBtn.onclick = (e) => runCustomBacktest(e, fileName);
                fileItem.appendChild(runBtn);
            }

            return fileItem;
        }

        function showPlaceholder(container, text) {
            const placeholder = document.createElement('div');
            placeholder.className = 'file-item';
            placeholder.style.fontStyle = 'italic';
            placeholder.style.opacity = '0.6';
            placeholder.textContent = text;
            container.appendChild(placeholder);
        }
    </script>
</body>

</html>
```